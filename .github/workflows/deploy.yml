name: Deploy over SSH
    uses: appleboy/ssh-action@v1.0.3
    with:
      host: ${{ secrets.DO_HOST }}
      username: ${{ secrets.DO_USER }}   # = deploy
      key: ${{ secrets.DO_SSH_KEY }}
      script: |
        set -e

        cd /var/www/seobooster

        # Git safe directory (kvůli dřívější chybě)
        git config --global --add safe.directory /var/www/seobooster

        # nvm + Node 22
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"
        nvm use 22

        git fetch origin main
        git reset --hard origin/main

        npm ci
        npx prisma generate

        npm run build

        pm2 reload ecosystem.config.js --env production || pm2 start ecosystem.config.js --env production
        pm2 save
